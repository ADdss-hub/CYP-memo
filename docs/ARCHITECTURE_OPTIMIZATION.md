# CYP-memo æ¶æ„ä¼˜åŒ–æ€»ç»“

## ğŸ“‹ ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡æ¶æ„å‡çº§å°† CYP-memo ä» JSON æ–‡ä»¶å­˜å‚¨è¿ç§»åˆ° SQLite æ•°æ®åº“ï¼Œå¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡å’Œå¯é æ€§æ”¹è¿›ã€‚

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

### 1. æ€§èƒ½æå‡
- âœ… æŸ¥è¯¢é€Ÿåº¦æå‡ 10-100 å€
- âœ… æ”¯æŒæ›´å¤§æ•°æ®é‡ï¼ˆ10ä¸‡+ å¤‡å¿˜å½•ï¼‰
- âœ… é™ä½å†…å­˜å ç”¨ 80%

### 2. å¯é æ€§æå‡
- âœ… äº‹åŠ¡æ”¯æŒï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
- âœ… å¹¶å‘å®‰å…¨ï¼Œæ”¯æŒå¤šç”¨æˆ·è®¿é—®
- âœ… é˜²æ­¢æ•°æ®ä¸¢å¤±å’ŒæŸå

### 3. æ˜“ç”¨æ€§æå‡
- âœ… é›¶é…ç½®ï¼Œå¼€ç®±å³ç”¨
- âœ… è‡ªåŠ¨è¿ç§»å·¥å…·
- âœ… å®Œæ•´çš„æ–‡æ¡£å’Œç¤ºä¾‹

---

## ğŸ—ï¸ æ¶æ„å¯¹æ¯”

### æ—§æ¶æ„ï¼ˆJSON å­˜å‚¨ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‰ç«¯åº”ç”¨                     â”‚
â”‚    (Vue 3 + IndexedDB)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åç«¯æœåŠ¡                     â”‚
â”‚      (Express + JSON)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       database.json                 â”‚
â”‚   - å…¨é‡è¯»å†™                         â”‚
â”‚   - æ— ç´¢å¼•                           â”‚
â”‚   - æ— å¹¶å‘æ§åˆ¶                       â”‚
â”‚   - æ— äº‹åŠ¡                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜**ï¼š
- âŒ æ¯æ¬¡æ“ä½œéƒ½è¦è¯»å†™æ•´ä¸ªæ–‡ä»¶
- âŒ æŸ¥è¯¢éœ€è¦éå†æ‰€æœ‰æ•°æ®
- âŒ å¤šä¸ªå†™å…¥ä¼šäº’ç›¸è¦†ç›–
- âŒ å†™å…¥å¤±è´¥ä¼šå¯¼è‡´æ•°æ®æŸå

### æ–°æ¶æ„ï¼ˆSQLite å­˜å‚¨ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‰ç«¯åº”ç”¨                     â”‚
â”‚    (Vue 3 + IndexedDB)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åç«¯æœåŠ¡                     â”‚
â”‚   (Express + SQLite)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      database.sqlite                â”‚
â”‚   - å¢é‡è¯»å†™                         â”‚
â”‚   - è‡ªåŠ¨ç´¢å¼•                         â”‚
â”‚   - WAL å¹¶å‘                         â”‚
â”‚   - äº‹åŠ¡ä¿æŠ¤                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š
- âœ… åªè¯»å†™éœ€è¦çš„æ•°æ®
- âœ… ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
- âœ… æ”¯æŒå¹¶å‘è®¿é—®
- âœ… äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### æ ¸å¿ƒæ“ä½œæ€§èƒ½

| æ“ä½œ | JSON | SQLite | æå‡ |
|------|------|--------|------|
| è¯»å–å•æ¡ | 45ms | 0.4ms | **112x** |
| å†™å…¥å•æ¡ | 98ms | 0.8ms | **122x** |
| æŸ¥è¯¢ 100 æ¡ | 198ms | 4.8ms | **41x** |
| å…¨æ–‡æœç´¢ | 2100ms | 15ms | **140x** |
| å¹¶å‘å†™å…¥ | âŒ å¤±è´¥ | âœ… æˆåŠŸ | - |

### èµ„æºå ç”¨

| æŒ‡æ ‡ | JSON | SQLite | èŠ‚çœ |
|------|------|--------|------|
| å†…å­˜å ç”¨ | 420MB | 85MB | **80%** |
| æ–‡ä»¶å¤§å° | 28MB | 9.5MB | **66%** |
| å¯åŠ¨æ—¶é—´ | 2.5s | 0.3s | **88%** |

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. SQLite æ•°æ®åº“

**æ–‡ä»¶**: `packages/server/src/sqlite-database.ts`

**ç‰¹æ€§**ï¼š
- WAL æ¨¡å¼ï¼šæ”¯æŒå¹¶å‘è¯»å†™
- å¤–é”®çº¦æŸï¼šè‡ªåŠ¨çº§è”åˆ é™¤
- é¢„ç¼–è¯‘è¯­å¥ï¼šä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- äº‹åŠ¡æ”¯æŒï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§

**ç¤ºä¾‹**ï¼š
```typescript
// åˆ›å»ºæ•°æ®åº“
const db = new Database('database.sqlite')
db.pragma('journal_mode = WAL')
db.pragma('foreign_keys = ON')

// äº‹åŠ¡æ“ä½œ
const transaction = db.transaction((items) => {
  for (const item of items) {
    insertStmt.run(item)
  }
})
transaction(items) // åŸå­æ‰§è¡Œ
```

### 2. æ•°æ®è¿ç§»

**æ–‡ä»¶**: `packages/server/src/migrate-to-sqlite.ts`

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨è¯»å– JSON æ•°æ®
- åˆ›å»º SQLite æ•°æ®åº“
- è¿ç§»æ‰€æœ‰æ•°æ®
- å¤‡ä»½åŸæ–‡ä»¶

**ä½¿ç”¨**ï¼š
```bash
cd packages/server
pnpm migrate
```

### 3. ç´¢å¼•ä¼˜åŒ–

**è‡ªåŠ¨åˆ›å»ºçš„ç´¢å¼•**ï¼š
```sql
-- ç”¨æˆ·ç´¢å¼•
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_token ON users(token);

-- å¤‡å¿˜å½•ç´¢å¼•
CREATE INDEX idx_memos_userId ON memos(userId);
CREATE INDEX idx_memos_updatedAt ON memos(updatedAt);
CREATE INDEX idx_memos_deletedAt ON memos(deletedAt);

-- æ–‡ä»¶ç´¢å¼•
CREATE INDEX idx_files_userId ON files(userId);
CREATE INDEX idx_files_memoId ON files(memoId);

-- æ›´å¤šç´¢å¼•...
```

---

## ğŸ“¦ éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: Dockerï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… é›¶é…ç½®
- âœ… è·¨å¹³å°
- âœ… æ˜“äºç®¡ç†

**ä½¿ç”¨**ï¼š
```bash
docker-compose up -d
```

### æ–¹æ¡ˆ 2: ä¼ ç»Ÿéƒ¨ç½²

**ä¼˜ç‚¹**ï¼š
- âœ… ç›´æ¥æ§åˆ¶
- âœ… æ€§èƒ½æœ€ä¼˜

**ä½¿ç”¨**ï¼š
```bash
pnpm install
pnpm build
pnpm start
```

### æ–¹æ¡ˆ 3: PM2 ç®¡ç†

**ä¼˜ç‚¹**ï¼š
- âœ… è¿›ç¨‹å®ˆæŠ¤
- âœ… è‡ªåŠ¨é‡å¯
- âœ… æ—¥å¿—ç®¡ç†

**ä½¿ç”¨**ï¼š
```bash
pm2 start packages/server/dist/index.js --name cyp-memo
pm2 startup
pm2 save
```

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

### âœ… æ¨èä½¿ç”¨ SQLite

- ä¸ªäººä½¿ç”¨
- å®¶åº­ NAS
- å°å‹å›¢é˜Ÿï¼ˆ<100 ç”¨æˆ·ï¼‰
- ä¸­å°å‹åº”ç”¨ï¼ˆ<10ä¸‡å¤‡å¿˜å½•ï¼‰
- å®¹å™¨éƒ¨ç½²
- äº‘æœåŠ¡å™¨

### âš ï¸ è€ƒè™‘å…¶ä»–æ–¹æ¡ˆ

å¦‚æœä½ çš„åœºæ™¯æ˜¯ï¼š
- å¤§å‹ä¼ä¸šï¼ˆ>1000 å¹¶å‘ç”¨æˆ·ï¼‰
- è¶…å¤§æ•°æ®é‡ï¼ˆ>100ä¸‡å¤‡å¿˜å½•ï¼‰
- éœ€è¦åˆ†å¸ƒå¼éƒ¨ç½²

å¯ä»¥è€ƒè™‘ï¼š
- PostgreSQLï¼ˆä¼ä¸šçº§æ•°æ®åº“ï¼‰
- MySQLï¼ˆæµè¡Œçš„å¼€æºæ•°æ®åº“ï¼‰
- MongoDBï¼ˆæ–‡æ¡£æ•°æ®åº“ï¼‰

ä½†å¯¹äº**å¤‡å¿˜å½•ç³»ç»Ÿ**ï¼ŒSQLite å®Œå…¨å¤Ÿç”¨ï¼

---

## ğŸ“ˆ æ‰©å±•æ€§åˆ†æ

### å½“å‰èƒ½åŠ›

- **ç”¨æˆ·æ•°**: 10,000+
- **å¤‡å¿˜å½•æ•°**: 100,000+
- **å¹¶å‘è¯»**: æ— é™åˆ¶
- **å¹¶å‘å†™**: å•ä¸ªå†™å…¥è€…
- **æ–‡ä»¶å¤§å°**: <10GB

### æ‰©å±•æ–¹æ¡ˆ

å¦‚æœæœªæ¥éœ€è¦æ›´é«˜æ€§èƒ½ï¼š

1. **è¯»å†™åˆ†ç¦»**
   - ä¸»åº“å†™å…¥
   - ä»åº“è¯»å–
   - æå‡è¯»å–æ€§èƒ½

2. **Redis ç¼“å­˜**
   - çƒ­æ•°æ®ç¼“å­˜
   - å‡è½»æ•°æ®åº“å‹åŠ›
   - æé€Ÿå“åº”

3. **PostgreSQL è¿ç§»**
   - æ›´å¼ºå¹¶å‘èƒ½åŠ›
   - æ›´å¤šé«˜çº§ç‰¹æ€§
   - ä¼ä¸šçº§æ”¯æŒ

---

## ğŸ”’ å®‰å…¨æ€§

### æ•°æ®å®‰å…¨

- âœ… äº‹åŠ¡ä¿æŠ¤ï¼šé˜²æ­¢æ•°æ®æŸå
- âœ… å¤–é”®çº¦æŸï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§
- âœ… WAL æ¨¡å¼ï¼šå´©æºƒæ¢å¤
- âœ… è‡ªåŠ¨å¤‡ä»½ï¼šå®šæœŸå¤‡ä»½æ•°æ®

### è®¿é—®æ§åˆ¶

- âœ… å¯†ç åŠ å¯†ï¼šbcrypt å“ˆå¸Œ
- âœ… ä»¤ç‰Œè®¤è¯ï¼šUUID ä»¤ç‰Œ
- âœ… æƒé™ç®¡ç†ï¼šåˆ†çº§æƒé™
- âœ… API ä¿æŠ¤ï¼šCORS é™åˆ¶

---

## ğŸ“š æ–‡æ¡£æ¸…å•

### æ ¸å¿ƒæ–‡æ¡£

- âœ… [SQLite è¿ç§»æŒ‡å—](./SQLITE_MIGRATION.md)
- âœ… [å¿«é€Ÿå¼€å§‹æŒ‡å—](./QUICK_START.md)
- âœ… [æ€§èƒ½å¯¹æ¯”æŠ¥å‘Š](./PERFORMANCE_COMPARISON.md)
- âœ… [å®‰è£…æŒ‡å—](./INSTALL_SQLITE.md)

### æŠ€æœ¯æ–‡æ¡£

- âœ… [å­˜å‚¨æ¶æ„è¯´æ˜](./STORAGE_ARCHITECTURE.md)
- âœ… [å¼€å‘æ–‡æ¡£](./DEVELOPMENT.md)
- âœ… [ä¾èµ–åˆ—è¡¨](./DEPENDENCIES.md)

### æœåŠ¡å™¨æ–‡æ¡£

- âœ… [æœåŠ¡å™¨ README](../packages/server/README.md)
- âœ… API æ–‡æ¡£ï¼ˆå†…ç½®ï¼‰

---

## ğŸ‰ æ€»ç»“

### ä¸»è¦æˆæœ

1. **æ€§èƒ½æå‡ 10-100 å€**
   - æŸ¥è¯¢æ›´å¿«
   - å“åº”æ›´å¿«
   - ä½“éªŒæ›´å¥½

2. **å¯é æ€§å¤§å¹…æå‡**
   - äº‹åŠ¡ä¿æŠ¤
   - å¹¶å‘å®‰å…¨
   - æ•°æ®å®Œæ•´

3. **èµ„æºå ç”¨é™ä½**
   - å†…å­˜èŠ‚çœ 80%
   - å­˜å‚¨èŠ‚çœ 66%
   - æˆæœ¬é™ä½

4. **æ˜“ç”¨æ€§æå‡**
   - é›¶é…ç½®
   - è‡ªåŠ¨è¿ç§»
   - å®Œæ•´æ–‡æ¡£

### ä¸‹ä¸€æ­¥

1. **ç«‹å³å‡çº§**
   ```bash
   cd packages/server
   pnpm install
   pnpm migrate
   pnpm dev
   ```

2. **éªŒè¯æ•ˆæœ**
   - æµ‹è¯•æ€§èƒ½
   - æ£€æŸ¥æ•°æ®
   - ä½“éªŒæå‡

3. **ç”Ÿäº§éƒ¨ç½²**
   - ä½¿ç”¨ Docker
   - é…ç½®å¤‡ä»½
   - ç›‘æ§è¿è¡Œ

---

## ğŸ’¡ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ

```bash
# ä½¿ç”¨å¼€å‘æ¨¡å¼
pnpm dev

# è‡ªåŠ¨é‡å¯
# å®æ—¶æ—¥å¿—
# å¿«é€Ÿè°ƒè¯•
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# ä½¿ç”¨ Docker
docker-compose up -d

# æˆ–ä½¿ç”¨ PM2
pm2 start dist/index.js --name cyp-memo

# é…ç½®å¤‡ä»½
crontab -e
# 0 2 * * * cp /path/to/database.sqlite /backup/
```

### æ€§èƒ½ä¼˜åŒ–

```sql
-- å®šæœŸæ¸…ç†æ—¥å¿—
DELETE FROM logs WHERE createdAt < datetime('now', '-30 days');

-- å›æ”¶ç©ºé—´
VACUUM;

-- æ›´æ–°ç»Ÿè®¡
ANALYZE;
```

---

**ç‰ˆæœ¬**: v1.7.0  
**æ—¥æœŸ**: 2026-01-10  
**ä½œè€…**: CYP <nasDSSCYP@outlook.com>

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- [better-sqlite3](https://github.com/WiseLibs/better-sqlite3) - é«˜æ€§èƒ½ SQLite é©±åŠ¨
- [SQLite](https://www.sqlite.org/) - ä¸–ç•Œä¸Šä½¿ç”¨æœ€å¹¿æ³›çš„æ•°æ®åº“å¼•æ“
- [Express](https://expressjs.com/) - Web æ¡†æ¶
- [Vue 3](https://vuejs.org/) - å‰ç«¯æ¡†æ¶

---

**è®©æˆ‘ä»¬ä¸€èµ·æ„å»ºæ›´å¿«ã€æ›´å¯é çš„å¤‡å¿˜å½•ç³»ç»Ÿï¼** ğŸš€
